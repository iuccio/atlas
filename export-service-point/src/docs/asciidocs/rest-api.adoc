= ATLAS - Service Point Export Service API Guide
:doctype: book
:compat-mode:
:page-layout!:
:toc: left
:toclevels: 3
:sectanchors:
:sectlinks:
:linkattrs:
:icons: font
:table-caption!:
:source-highlighter: highlightjs
:highlightjsdir: highlight
:revnumber: {version}

[[abstract]]
= Overview

=== Project information

[width="60%" cols="18%,35%" ]
|=================================
|Application Name | {name}
|Version | {version}
|Build-Time| {buildTime}
|=================================

=== Developer Portal

This API is available as a part of the ATLAS API on the SBB developer portal.

- Production: https://developer.sbb.ch/apis/atlas/information
- Lower Stages are available here: https://developer-int.sbb.ch/apis?all=&text=atlas&scopes=PUBLIC;INTERNAL

=== Release Notes

include::../release-notes.adoc[]

= Export

This service exports the following data:

*Service Point directory*:

* *Service Point Versions*
* *Traffic Point Element Versions*
* *Loading Point Versions*

*PRM (Person with Reduced Mobility) Directory*:

* *Stop Point Versions*

== Service Point Directory

=== Service Point Versions

Service Point Versions data is available via the ServicePoint API or as a File (CSV or JSON) via the Export Service Point API or through the Amazon S3 Bucket Client (CSV and JSON);

The Export Service Point generates nightly the following zipped CSV and gzipped JSON files:

* WORLD FULL
* WORLD ONLY ACTUAL DATE
* WORLD ONLY FUTURE TIMETABLE
* SWISS FULL
* SWISS ONLY ACTUAL DATE
* SWISS ONLY FUTURE TIMETABLE

If you want to consume this files you have two options:

* Via API: see **Export Service Point Directory API** section
* Through the Amazon S3 Bucket Client: see **Atlas Amazon S3 Bucket Users onboarding**

==== Data Mapping Migration from DiDok to ATLAS

See https://confluence.sbb.ch/x/GI3aj to get additional information about the data mapping migration from DiDok to ATLAS.

=== Traffic Point Element Versions

Traffic Point Element Versions data is available via the ServicePoint API or as a File (CSV or JSON) via the Export Service Point API or through the Amazon S3 Bucket Client (CSV and JSON);

The Export Service Point Directory generates nightly the following zipped CSV and gzipped JSON files:

* WORLD FULL
* WORLD ONLY ACTUAL DATE
* WORLD ONLY FUTURE TIMETABLE

If you want to consume this files you have two options:

* Via API: see **Export Service Point Directory API** section
* Through the Amazon S3 Bucket Client: see **Atlas Amazon S3 Bucket Users onboarding**

==== Data Mapping Migration from DiDok to ATLAS

See https://confluence.sbb.ch/x/PB1Xl to get additional information about the data mapping migration from DiDok to ATLAS.

=== Loading Point Versions

Loading Point Versions data is available via the ServicePoint API or as a File (CSV or JSON) via the Export Service Point API or through the Amazon S3 Bucket Client (CSV and JSON);

The Export Service Point Directory generates nightly the following zipped CSV and gzipped JSON files:

* WORLD FULL
* WORLD ONLY ACTUAL DATE
* WORLD ONLY FUTURE TIMETABLE

If you want to consume this files you have two options:

* Via API: see **Export Service Point Directory API** section
* Through the Amazon S3 Bucket Client: see **Atlas Amazon S3 Bucket Users onboarding**

==== Data Mapping Migration from DiDok to ATLAS

See https://confluence.sbb.ch/x/6R_uj to get additional information about the data mapping migration from DiDok to ATLAS.

include::../../../../base-atlas/documentation/servicepoint/when_to_use_files_or_API.adoc[]

include::../../../../base-atlas/documentation/amazon/Amazon_S3_Buckets_Users_Onboarding.adoc[]

== Export Service Point Directory API

=== Trigger export Service Point Versions - Successfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-post-service-point-export-batch-successfully/auto-section.adoc[]

=== Trigger export Traffic Point Element Versions - Successfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-post-traffic-point-export-batch-successfully/auto-section.adoc[]

=== Trigger export Loading Point Versions - Successfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-post-loading-point-export-batch-successfully/auto-section.adoc[]

=== Get Service Point Json - Successfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-get-json-successfully/auto-section.adoc[]

=== Get Service Point Json - Unsuccessfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-get-json-unsuccessfully/auto-section.adoc[]

=== Get download Service Point Gzip Json - Successfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-download-gzip-json-successfully/auto-section.adoc[]

=== Get download Latest Service Point Gzip Json - Successfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-download-latest-gzip-json-successfully/auto-section.adoc[]

=== Get download Service Point Gzip Json - Unsuccessfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-download-gzip-json-unsuccessfully/auto-section.adoc[]

=== Get download Traffic Point/Loading Point Gzip Json - Unsuccessfully

include::{snippets}/export-service-point-batch-controller-api-v1-integration-test/should-not-download-json-when-export-type-is-not-allowed-for-the-export-file/auto-section.adoc[]

== PRM (Person with Reduced Mobility) Directory

=== Stop Point Versions

Stop Point Versions data is available via the PRM-Directory StopPoint API or as a File (CSV or JSON) via the Export Stop Point API or through the Amazon S3 Bucket Client (CSV and JSON);

The Export Stop Point generates nightly the following zipped CSV and gzipped JSON files:

* FULL
* ACTUAL DATE
* FUTURE TIMETABLE

If you want to consume this files you have two options:

* Via API: see **Export Stop Point Directory API** section
* Through the Amazon S3 Bucket Client: see **Atlas Amazon S3 Bucket Users onboarding**

==== Data Mapping Migration from DiDok to ATLAS-PRM

See https://confluence.sbb.ch/x/GI3aj to get additional information about the data mapping migration from DiDok to ATLAS.

=== Trigger Export Stop Point Json - Successfully

include::{snippets}/export-stop-point-batch-controller-api-v1-integration-test/should-post-stop-point-export-batch-successfully/auto-section.adoc[]

=== Get Json - Successfully

include::{snippets}/export-prm-batch-controller-api-v1-integration-test/should-get-json-successfully/auto-section.adoc[]

=== Get Json - Unsuccessfully

include::{snippets}/export-prm-batch-controller-api-v1-integration-test/should-get-json-unsuccessfully/auto-section.adoc[]

=== Download Gzip Json - Successfully

include::{snippets}/export-prm-batch-controller-api-v1-integration-test/should-download-gzip-json-successfully/auto-section.adoc[]

=== Download Gzip Json - Unsuccessfully

include::{snippets}/export-prm-batch-controller-api-v1-integration-test/should-download-gzip-json-unsuccessfully/auto-section.adoc[]

=== Download Latest Json - Successfully

include::{snippets}/export-prm-batch-controller-api-v1-integration-test/should-download-latest-json-successfully/auto-section.adoc[]

=== Download Latest Gzip Json - Successfully

include::{snippets}/export-prm-batch-controller-api-v1-integration-test/should-download-latest-gzip-json-successfully/auto-section.adoc[]
